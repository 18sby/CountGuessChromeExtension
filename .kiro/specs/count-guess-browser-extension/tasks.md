# 实施计划

- [x] 1. 设置Chrome扩展基础结构
  - 创建manifest.json文件，配置Manifest V3规范
  - 创建基本的目录结构（popup、scripts、styles、assets）
  - 配置扩展权限（storage用于IndexedDB）
  - _需求: 8.1, 8.4_

- [x] 2. 实现IndexedDB数据层
  - [x] 2.1 创建数据库初始化模块
    - 编写IndexedDB数据库创建和版本管理代码
    - 定义三个对象存储：dailyCounters、historyRecords、appState
    - 为historyRecords创建date索引
    - _需求: 6.1, 6.2_
  
  - [x] 2.2 实现数据访问函数
    - 编写读取和更新当前计数器的函数
    - 编写保存和查询历史记录的函数
    - 编写管理应用状态（导出提醒）的函数
    - 实现错误处理和localStorage回退机制
    - _需求: 6.3, 6.4_

- [x] 3. 创建弹窗UI结构和样式
  - [x] 3.1 构建HTML结构
    - 创建popup.html，包含四个角色按钮区域
    - 为每个角色添加进度条元素
    - 添加导出按钮和导出提醒容器
    - 使用语义化HTML元素
    - _需求: 1.1, 3.1, 5.1_
  
  - [x] 3.2 实现CSS样式和主题
    - 为四个角色定义颜色主题（红、蓝、绿、黄）
    - 实现响应式布局（支持320px-800px宽度）
    - 设置按钮和进度条的基础样式
    - 实现触摸友好的按钮尺寸（最小44×44px）
    - _需求: 1.2, 1.3, 1.4, 1.5, 8.3_

- [x] 4. 实现角色按钮交互逻辑
  - [x] 4.1 创建计数器管理模块
    - 定义CHARACTERS配置数组
    - 实现按钮点击事件处理器
    - 编写增加计数的逻辑（最大300）
    - 实现计数达到300时禁用按钮
    - 将计数更新保存到IndexedDB
    - _需求: 2.1, 2.4_
  
  - [x] 4.2 实现按钮动画效果
    - 创建点击时的缩放动画（300ms）
    - 实现达到最大值时的闪烁动画
    - 使用CSS transitions实现动画
    - 添加will-change优化和prefers-reduced-motion支持
    - _需求: 2.3, 2.5, 7.1, 7.4_

- [x] 5. 实现进度条功能
  - [x] 5.1 创建进度条更新逻辑
    - 编写计算进度百分比的函数（currentCount / 300 × 100%）
    - 实现进度条填充的动态更新
    - 在进度条旁显示数字计数（格式：150/300）
    - 应用角色主题颜色到进度条
    - _需求: 3.3, 3.4, 3.5_
  
  - [x] 5.2 添加进度条动画
    - 实现平滑渐变过渡动画（300ms）
    - 创建每日重置时的淡出/淡入效果（500ms）
    - 使用CSS transitions实现
    - _需求: 3.2, 4.3, 7.2, 7.3_

- [x] 6. 实现每日重置机制
  - [x] 6.1 创建日期检测和重置逻辑
    - 实现日期比较函数（当前日期 vs 存储的最后活动日期）
    - 在弹窗打开时检查是否需要重置
    - 编写重置前保存历史记录的逻辑
    - 实现将所有计数器重置为0的函数
    - 重新启用所有角色按钮
    - _需求: 4.1, 4.2, 4.4, 4.5_
  
  - [x] 6.2 实现后台监控
    - 创建service worker用于持久监控
    - 使用setInterval每分钟检查时间
    - 在检测到午夜转换时触发重置
    - _需求: 4.1_

- [x] 7. 实现CSV导出功能
  - [x] 7.1 创建CSV生成模块
    - 从IndexedDB查询所有历史记录
    - 生成CSV格式字符串（英文表头：Date, Sneezy Boom, Stampy Sigh, Grumble Gus, Negative Ned）
    - 处理空历史记录场景
    - 实现数据验证
    - _需求: 5.2, 5.3, 5.4_
  
  - [x] 7.2 实现文件下载功能
    - 创建Blob对象和下载链接
    - 触发浏览器下载
    - 设置文件名格式（count-guess-history-YYYY-MM-DD.csv）
    - 添加错误处理和重试选项
    - _需求: 5.5_

- [x] 8. 实现导出提醒系统
  - [x] 8.1 创建提醒显示逻辑
    - 检查当前日期是否为每月1号
    - 计算提醒显示天数（最多7天）
    - 在弹窗中显示提醒UI（英文文本）
    - 从appState读取和更新提醒状态
    - _需求: 5.6, 5.7_
  
  - [x] 8.2 实现提醒关闭逻辑
    - 成功导出后关闭提醒
    - 7天后自动关闭提醒
    - 更新appState中的lastExportDate
    - _需求: 5.8, 5.9_

- [x] 9. 实现弹窗初始化和生命周期管理
  - [x] 9.1 创建弹窗加载逻辑
    - 初始化IndexedDB连接
    - 检查并执行每日重置（如需要）
    - 从数据库加载当前计数器状态
    - 渲染UI并绑定事件监听器
    - 检查并显示导出提醒
    - _需求: 4.5, 6.4_
  
  - [x] 9.2 实现状态持久化
    - 确保所有计数更新立即保存到IndexedDB
    - 实现幂等的数据保存逻辑
    - 添加数据完整性检查
    - _需求: 6.3_

- [x] 10. 错误处理和用户反馈
  - [x] 10.1 实现错误处理机制
    - 添加IndexedDB错误捕获和localStorage回退
    - 实现CSV导出错误处理和重试
    - 添加每日重置错误日志
    - 在UI中显示用户友好的错误消息
    - _需求: 6.1_
  
  - [x] 10.2 添加调试和日志功能
    - 实现控制台日志记录
    - 添加重置事件日志
    - 创建"重置数据"选项（用于数据损坏情况）

- [ ] 11. 优化和性能调整
  - [x] 11.1 实现性能优化
    - 优化动画性能（确保60fps）
    - 减少IndexedDB查询次数
    - 实现requestAnimationFrame（如需要）
    - 确保弹窗加载时间 < 100ms
    - _需求: 7.4, 7.5_
  
  - [-] 11.2 验证包大小和资源使用
    - 检查扩展包总大小 < 5MB
    - 监控内存使用 < 10MB
    - 优化资源加载
    - _需求: 8.5_

- [ ] 12. 集成测试和验证
  - [ ] 12.1 测试核心功能流程
    - 测试完整的计数流程（点击、更新、达到最大值）
    - 测试每日重置流程（保存历史、重置计数、重新启用按钮）
    - 测试CSV导出和下载
    - 测试导出提醒显示和关闭
    - _需求: 所有需求_
  
  - [ ] 12.2 测试边界情况和错误场景
    - 测试IndexedDB配额超限情况
    - 测试空历史记录导出
    - 测试跨日期的弹窗会话
    - 测试离线功能
    - _需求: 6.5_
  
  - [ ] 12.3 性能和兼容性测试
    - 在最新稳定版Chrome上测试
    - 测试不同窗口尺寸的响应性
    - 使用Chrome DevTools分析性能
    - 在低端设备上测试动画性能
    - _需求: 8.2, 8.3_
